---
type: work
---

<link rel="stylesheet" href="/styles/custom.css" />

import {
  Label,
  Summary,
  Metadata,
  RequiredStatement,
  References,
} from "@canopy-iiif/app/ui/server";

import { useEffect } from "react";

export default function WorkLayout(props) {
  // Extract all metadata + summary text from manifest
  const metadataText = [
    props.manifest.summary || "",
    ...(props.manifest.metadata || []).map(m => `${m.label}: ${m.value}`)
  ].join(" ");

  useEffect(() => {
    const glossaryContainer = document.getElementById("glossary-section");
    const metadataContainer = document.getElementById("metadata-highlighted");
    if (!glossaryContainer || !metadataContainer) return;

    const loadGlossary = async () => {
      try {
        const { glossaryTerms } = await import("../../app/js/glossary-terms.js");
        const mod = await import("../../app/js/glossary-functions.js");

        // Identify matches
        const matches = mod.identifyGlossaryMatches(metadataText, glossaryTerms);

        // Highlight metadata text and inject into container
        metadataContainer.innerHTML = mod.highlightGlossaryTermsString(metadataText, matches);

        // Render glossary panel
        mod.renderGlossary(matches, glossaryContainer);

        // Attach tooltips
        mod.attachGlossaryTooltips(metadataContainer);
      } catch (e) {
        console.error("Glossary initialization failed:", e);
      }
    };

    loadGlossary();
  }, [metadataText]);

  return (
    <>
      <Container variant="wide" className="canopy-work--layout">
        <div className="canopy-work--primary">
          <Viewer iiifContent={props.manifest.id} />
        </div>

        <div className="canopy-work--secondary">
          <header>
            <Label manifest={props.manifest} as="h1" />
          </header>

          {/* Metadata + glossary highlights */}
          <div id="metadata-highlighted"></div>

          {/* Glossary panel */}
          <div id="glossary-section"></div>
        </div>
      </Container>

      <Container>
        <h2>Related Items</h2>
        <RelatedItems iiifContent={props.manifest.id} top={3} />
      </Container>
    </>
  );
}
