---
type: work
---

<link rel="stylesheet" href="/styles/custom.css" />

import {
  Label,
  Summary,
  Metadata,
  RequiredStatement,
  References,
} from "@canopy-iiif/app/ui/server";

import { useEffect } from "react";

export default function WorkLayout(props) {
 useEffect(() => {
  const secondary = document.querySelector(".canopy-work--secondary");
  const glossaryContainer = document.getElementById("glossary-section");
  if (!secondary || !glossaryContainer) return;

  console.log("Secondary container found:", secondary);
  console.log("Glossary container found:", glossaryContainer);

  const observer = new MutationObserver(async () => {
    const summaryDiv = secondary.querySelector(".canopy-summary");
    const metadataDiv = secondary.querySelector(".canopy-work--metadata");

    console.log("Summary found:", summaryDiv);
    console.log("Metadata found:", metadataDiv);

    if (!summaryDiv && !metadataDiv) return;

    try {
      const { glossaryTerms } = await import("../../app/js/glossary-terms.js");
      const mod = await import("../../app/js/glossary-functions.js");

      const textToScan = [
        summaryDiv?.textContent || "",
        metadataDiv?.textContent || ""
      ].join(" ");

      console.log("Text to scan:", textToScan);

      const matches = mod.identifyGlossaryMatches(textToScan, glossaryTerms);
      console.log("Glossary matches found:", matches);

      if (summaryDiv) summaryDiv.innerHTML = mod.highlightGlossaryTermsString(summaryDiv.textContent, matches);
      if (metadataDiv) metadataDiv.innerHTML = mod.highlightGlossaryTermsString(metadataDiv.textContent, matches);

      mod.renderGlossary(matches, glossaryContainer);
      if (summaryDiv) mod.attachGlossaryTooltips(summaryDiv);
      if (metadataDiv) mod.attachGlossaryTooltips(metadataDiv);

      observer.disconnect();
    } catch (e) {
      console.error("Glossary initialization failed:", e);
    }
  });

  observer.observe(secondary, { childList: true, subtree: true });
  return () => observer.disconnect();
}, []);

  return (
    <>
      <Container variant="wide" className="canopy-work--layout">
        <div className="canopy-work--primary">
          <Viewer iiifContent={props.manifest.id} />
        </div>

        <div className="canopy-work--secondary">
          <header>
            <Label manifest={props.manifest} as="h1" />
            <Summary manifest={props.manifest} as="p" className="canopy-summary canopy-lead" />
          </header>

          <Metadata manifest={props.manifest} className="canopy-work--metadata" />

          {/* Glossary panel */}
          <div id="glossary-section"></div>
        </div>
      </Container>

      <Container>
        <h2>Related Items</h2>
        <RelatedItems iiifContent={props.manifest.id} top={3} />
      </Container>
    </>
  );
}
